<% layout('layouts/boiler') %>
<script>
    let token = "<%= mapToken %>";
    const geo = "<%- JSON.stringify(data.coordinate.coordinates) %>";
    let loc = "<%= data.location %>"; 
</script>

<body>
<div class="container-fluid mt-4">
  <div class="row g-4 align-items-start">
    <div class="col-12 col-lg-6">
      <h1 class="hero_text card-title mb-3 p-3 text-center text-lg-start">
        <%= data.title %>
      </h1>

      <div class="card-details-booking mx-auto mx-lg-0 mt-2 mb-5" style="max-width: 400px;">
        <b>
          <p class="fs-5 text-center text-lg-start">
            â‚¹<%= data.price.toLocaleString("en-IN") %> / Night
          </p>
        </b>

        <form class="details-booking" action="/listing/details/<%=data._id%>/booking" method="post">
          <div class="mb-3">
            <input type="number" class="form-control rounded-pill formbox"
                   id="guests" name="guests" min="1" max="10"
                   required placeholder="No. of guests">
          </div>

          <div class="input-group mb-3">
            <input type="date" class="form-control rounded-pill formbox" name="checkIn">
          </div>

          <div class="input-group mb-3">
            <input type="date" class="form-control rounded-pill formbox" name="checkOut">
          </div>

          <button class="btn btn-primary w-100 rounded-pill" type="submit">
            Check availability
          </button>
        </form>
      </div>
    </div>

    <!-- Right Section -->
    <div class="col-12 col-lg-6">
      <img src="<%=data.image.url%>" class="card-img-top-details img-fluid rounded-4 shadow-sm" alt="Listing Image">

      <div class="d-flex flex-column flex-sm-row justify-content-between landing_page_widget_white rounded-pill px-4 py-2 mt-3 text-center">
        <div>Hosted by <%= data.owner.username %></div>
        <div class="fw-semibold">Located in <%= data.location %></div>
      </div>
    </div>
  </div>

  <!-- Description -->
  <div class="row mt-4">
    <div class="col">
      <p class="card-text para2 p-3 text-center text-md-start">
        <%= data.description %>
      </p>
    </div>
  </div>

  <hr class="line my-4">

  <!-- Reviews -->
  <% if (data.review.length > 0) { %>
  <div class="showcomments">
    <h1 class="hero_text fs-2 text-center mb-4">Reviews</h1>
    <div class="row row-cols-1 row-cols-md-2 g-4 mb-5">
      <% for (review of data.review) { %>
      <div class="col">
        <div class="reviewcard p-3 rounded-4 shadow-sm">
          <div class="reviewcardhead d-flex justify-content-between align-items-center">
            <h4 class="para reviewcardname ms-2"><%= review.author.username %></h4>
            <p class="starability-result" data-rating="<%= review.rating %>"></p>
          </div>
          <div class="reviewcardbody mt-2">
            <p class="card-text para"><%= review.review %></p>
            <h6 class="revdate para1">Posted on: <%= review.date.toISOString().split('T')[0] %></h6>
            <% if (currentuser && currentuser._id.equals(review.author._id)) { %>
              <form method="post" action="/listing/delete/<%=data._id%>/review/<%=review._id%>?_method=delete">
                <button type="submit" class="btn btn-primary rounded-pill px-4 mt-2">Delete</button>
              </form>
            <% } %>
          </div>
        </div>
      </div>
      <% } %>
    </div>
  </div>
  <% } %>

  <!-- Leave a Review -->
  <% if (currentuser) { %>
  <div class="postcomment col-12 col-md-8 col-lg-6 mx-auto mb-5">
    <h1 class="hero_text fs-2 text-center mb-4">Leave a review</h1>
    <form method="post" action="/listing/details/<%=data._id%>/review">
      <fieldset class="starability-checkmark mb-3 text-center">
        <input type="radio" id="no-rate" class="input-no-rate" name="rating" value="0" checked aria-label="No rating." />
        <input type="radio" id="first-rate1" name="rating" value="1" /><label for="first-rate1" title="Terrible">1</label>
        <input type="radio" id="first-rate2" name="rating" value="2" /><label for="first-rate2" title="Not good">2</label>
        <input type="radio" id="first-rate3" name="rating" value="3" /><label for="first-rate3" title="Average">3</label>
        <input type="radio" id="first-rate4" name="rating" value="4" /><label for="first-rate4" title="Very good">4</label>
        <input type="radio" id="first-rate5" name="rating" value="5" /><label for="first-rate5" title="Amazing">5</label>
      </fieldset>

      <div class="form-floating mb-3">
        <textarea class="form-control formbox1" name="review" placeholder="Leave a comment" id="floatingTextarea2"
                  style="height: 150px"></textarea>
        <label for="floatingTextarea2">Review</label>
      </div>

      <button class="btn btn-primary w-100 rounded-pill" type="submit">Submit</button>
    </form>
  </div>
  <% } %>

  <!-- Map -->
  <h1 class="hero_text fs-2 text-center mb-3">Where you'll be</h1>
  <div id="map" class="mb-5 mt-3 rounded-4 shadow-sm" style="height: 400px; width: 100%;"></div>
</div>

<script src="/js/map.js"></script>
</body>
